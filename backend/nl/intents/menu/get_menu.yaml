id: GET_MENU
patterns:
  - keywords:
      all: ["menu"]
      none: ["buffer", "update", "set"]
slots:
  - name: date
    type: date
    default: today
    required: true
    validators:
      - required
  - name: bld_type
    type: enum
    meta:
      enum: meal
sql:
  query: |
    SELECT
      mi.menu_item_id,
      m.date,
      b.bld_type,
      i.item_id,
      i.name AS item_name,
      mi.rate,
      mi.buffer_qty,
      mi.final_qty,
      mi.planned_qty,
      mi.available_qty,
      mi.sort_order,
      mi.is_default,
      c.category_name
    FROM menu m
    JOIN bld b ON b.bld_id = m.bld_id
    JOIN menu_items mi ON mi.menu_id = m.menu_id
    JOIN items i ON i.item_id = mi.item_id
    LEFT JOIN categories c ON c.category_id = i.category_id
    WHERE m.date = :date
      AND (:bld_type IS NULL OR b.bld_type = :bld_type)
    ORDER BY b.bld_type, c.category_name, i.name
projection:
  - menu_item_id
  - date
  - bld_type
  - item_id
  - item_name
  - rate
  - buffer_qty
  - final_qty
  - planned_qty
  - available_qty
  - sort_order
  - is_default
  - category_name
responses:
  success_note: Retrieved menu.
  not_found_message: No menu configured for that date.
examples:
  - what's today's menu?
  - breakfast menu for friday
